# Pixel People Optimal Assignments

Pixel People is a game where you splice two different jobs together to get a new job. And each new job can unlock new buildings for them to work at. But as there are more than 400 jobs, it gets hard to keep track of how much each makes. And what is the best way for you to make money?

# How to Use
1. Make sure data is up-to-date by running `scrape.py`. This uses the Pixel People Wikia to get the necessary data.
2. Update what you have in the `qbuilding.csv` and `qpeople.csv` files.
3. Run `main.py`. The final solution will be in a `result.csv` file.
  * A summarized result will be output to console.
  * You can use the log to see exactly what decisions were made.

## Fixing input data
* Ballpark's multiplier/maxCPS is listed for x1, it was fixed to x3.
* Embassy's multipler/maxCPS is listed for x1, it was fixed to x2.
* Funeral Parlor lists Gravedigger as "Grave Digger". It was fixed to be one word.<br>

Some pages had extra jobs from before the remastered version, so I manually wrote those rows in.

I wanted to further pinpoint an optimal coin output, so I added time as a column and calculated the total CPS for each building. It can further be implemented for choices during execution.

## Attempted solution 1:
* Naive approach: Just put people into random allowed jobs and permutate until we get the right answer.
* This will be very slow. Assuming that each job can go into a maximum of 3 jobs, that would be a space complexity of O(3^*n*), where *n* is 430. So let's not.

## Attempted solution 2:
* Smarter approach: Many of the jobs won't overlap with each other. Some groups of jobs only have 1 or 2 buildings that they can all go to. This can cut down *n* in permutations. Try clustering all buildings and jobs that are actually related to each other. Think of each job and building as a single node in a graph. Not all of the graphs connect with each other. This should cut down the runtime for each permutation calculation by a lot.

Problem: 40 clusters were created. Most of them were less than 10 nodes in size. However, the final cluster still had 123 jobs to go through. That's 3^{123} permutations. Still too many.

* Add-on: I've tried to make this run faster by optimized each operation done through the recursion, but every 100000 iterations still took 3.5 seconds each. This has to scale to half a googol iterations, so it was still not feasible.

## Attempted solution 3: Priority queue iterating through 2m buildings.
Problem: We don't currently have a way to determine if two buildings of a lower CPS can surpass one building of a higher CPS (ex. 6 < 4 + 4).

## Attempted solution 4:
* Priority queue of buildings: We want to find the maximum CPS that can be generated by the buildings as a whole. It makes sense to use a greedy approach, however we are uncertain if a specific combination of lower CPS buildings can surpass a higher CPS building. To solve this, I sorted in ascending order. This way we will find every combination of lower CPS buildings before we hit the higher CPS buildings, and we will never lower the total CPS when iterating.
* For each building, see if we can completely fill the building. A x2 multiplier will activate for the building if every position is filled. For each worker, we want to see if A) we have the worker and B) if removing the worker and adding them to the current building will create a net increase in CPS. If we have every worker and filling the building has a net increase on total CPS, we can pull each worker out of their previous location (update other workers' multipliers if the building is not full anymore) and put them in the current building.
* This operation should be hypothetical to start with. It should be a check. If we don't actually have everyone needed or there is an overall decrease by doing this operation, we shouldn't do it at all.
* If we don't have a full building, we can still try to reassign people for a net increase. We just don't get to use the x2 bonus.
  * If the person we are trying to assign doesn't have a previous job, we can put them to work immediately.
  * If they do have a previous job, try to see if it creates a net increase using the condition described above.

* With this method, we will never decrease CPS as we look at and attempt to populate each building.<br>

Problem: the combination of two buildings' CPS can outweigh another building's CPS. Or vise versa. Then we'd have to revert changes made before.

## Attempted solution 5:
* We have a few cases to consider: populate buildings from nothing, an empty building outperforms a populated building, two smaller buildings outperform a larger building, two larger buildings outperform a smaller building. The main issue was covering the last 2 cases. I have an algorithm that will optimize when two buildings outperform another building (S4). So I tried to run the algorithm on both an ascending-sorted list and a descending-sorted list. At the end, I can compare the two results and make choices based on those.
* Currently assumes there is only one of each kind of building when comparing differences.

## Attempted solution 5.1:
* With the two lists that were used, I got a resulting CPS and configuration for each. However both were not close to my actual CPS in-game. I compared the differences between the two lists. I could clearly see what choices eac list resulted in, and what choices they agreed on. With this, saved the choices that were agreed upon and ran the algorithm again the buildings that had differences. I repeated this process until both lists agreed on every choice made. This brought my calculated CPS closer to the ideal: less than 10 CPS off.

One problem that was encountered was when pulling numerous people out of a fully-populated building, cps would drop way below 0. This was because the calculation did not "remove" a person when removing cps. To fix this, I used a set to make sure that we don't reduce cps by half for every person removed.

## Fixing input data
* Ballpark's multiplier/maxCPS is listed for x1, it was fixed to x3.
* Embassy's multipler/maxCPS is listed for x1, it was fixed to x2.<br>

I'm not in the mood to look up and fix 159 entries, so we rescraped and reassigned.<br>

Could run into a problem where the profession text does not line up for jobs and buildings, but we'll clear that hurdle when we get there (aka make a decision on how to handle it).

Some pages had extra jobs from before the remastered version, so I manually wrote those rows in.

I wanted to further pinpoint an optimal coin output, so I added time as a column and calculated the total CPS for each building. It can further be implemented for choices during execution.

## TODO
* Scrape from my excel sheet.